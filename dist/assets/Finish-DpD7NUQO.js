import"./index-TPQGTVDa.js";/* empty css                  *//* empty css               */import{g as M,d as P}from"./el-message-box-CaddNPrY.js";/* empty css                 *//* empty css                   */import{a8 as E,E as D,r as S,n as F}from"./element-0WP7HAzl.js";import{t as R,aC as C,V as v,n as U,v as B,M as n,E as r,z as w,u as c,ac as y,J as d,K as T,x as I}from"./vue-ClXjDkJM.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vxe-tYnSz-zK.js";const $={class:"app-container"},O=R({name:"VxeTable",__name:"Finish",setup(q){const l=C("xGridDom"),h=v({loading:!0,autoResize:!0,pagerConfig:{align:"right"},formConfig:{items:[{field:"username",itemRender:{name:"VxeInput",props:{placeholder:"用户名",clearable:!0}}},{field:"phone",itemRender:{name:"VxeInput",props:{placeholder:"手机号",clearable:!0}}},{itemRender:{name:"VxeButtonGroup",options:[{type:"submit",content:"查询",status:"primary",icon:"vxe-icon-search"},{type:"reset",content:"重置",icon:"vxe-icon-refresh"}]}}]},toolbarConfig:{refresh:!0,custom:!0,slots:{buttons:"toolbar-btns"}},customConfig:{checkMethod:({column:e})=>!["username"].includes(e.field)},columns:[{type:"checkbox",width:"50px"},{field:"username",title:"用户名"},{field:"roles",title:"角色",slots:{default:"role-column"}},{field:"phone",title:"手机号"},{field:"email",title:"邮箱"},{field:"status",title:"状态",slots:{default:"status-column"}},{field:"createTime",title:"创建时间"},{title:"操作",width:"150px",fixed:"right",showOverflow:!1,slots:{default:"row-operate"}}],proxyConfig:{seq:!0,form:!0,autoLoad:!0,props:{total:"total"},ajax:{query:({page:e,form:t})=>(h.loading=!0,o.clearTable(),new Promise(u=>{let m=0,f=[];const _=g=>{g?.data&&(m=g.data.total,f=g.data.list),h.loading=!1,u({total:m,result:f})},k={username:t.username||"",phone:t.phone||"",size:e.pageSize,currentPage:e.currentPage};M(k).then(_).catch(_)}))}}}),x=C("xModalDom"),b=v({title:"",showClose:!0,escClosable:!0,maskClosable:!0,beforeHideMethod:()=>(p.value?.clearValidate(),Promise.resolve())}),p=C("xFormDom"),i=v({span:24,titleWidth:"100px",loading:!1,titleColon:!1,data:{username:"",password:""},items:[{field:"username",title:"用户名",itemRender:{name:"$input",props:{placeholder:"请输入"}}},{field:"password",title:"密码",itemRender:{name:"$input",props:{placeholder:"请输入"}}},{align:"right",itemRender:{name:"$buttons",children:[{props:{content:"取消"},events:{click:()=>x.value?.close()}},{props:{type:"submit",content:"确定",status:"primary"},events:{click:()=>o.onSubmitForm()}}]}}],rules:{username:[{required:!0,validator:({itemValue:e})=>{switch(!0){case!e:return new Error("请输入");case!e.trim():return new Error("空格无效")}}}],password:[{required:!0,validator:({itemValue:e})=>{switch(!0){case!e:return new Error("请输入");case!e.trim():return new Error("空格无效")}}}]}}),o=v({isUpdate:!0,commitQuery:()=>l.value?.commitProxy("query"),clearTable:()=>l.value?.reloadData([]),onShowModal:e=>{e?(o.isUpdate=!0,b.title="修改用户",i.data.username=e.username):(o.isUpdate=!1,b.title="新增用户");const t=i.items?.[0]?.itemRender?.props;t&&(t.disabled=o.isUpdate),x.value?.open(),U(()=>{!o.isUpdate&&p.value?.reset(),p.value?.clearValidate()})},onSubmitForm:()=>{i.loading||p.value?.validate(e=>{if(e)return;i.loading=!0;const t=()=>{i.loading=!1,x.value?.close(),D.success("操作成功"),!o.isUpdate&&o.afterInsert(),o.commitQuery()};o.isUpdate?setTimeout(()=>t(),1e3):setTimeout(()=>t(),1e3)})},afterInsert:()=>{const e=l.value?.getProxyInfo()?.pager;e&&e.currentPage*e.pageSize===e.total&&++e.currentPage},onDelete:e=>{const t=`确定 <strong style="color: var(--el-color-danger);"> 删除 </strong> 用户 <strong style="color: var(--el-color-primary);"> ${e.username} </strong> ？`,u={type:"warning",showClose:!0,closeOnClickModal:!0,closeOnPressEscape:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0};E.confirm(t,"提示",u).then(()=>{P(e.id).then(()=>{D.success("删除成功"),o.afterDelete(),o.commitQuery()})})},afterDelete:()=>{const e=l.value.getData(),t=l.value?.getProxyInfo()?.pager;t&&t.currentPage>1&&e.length===1&&--t.currentPage},moreFn:()=>{}});return(e,t)=>{const u=y("vxe-button"),m=F,f=S,_=y("vxe-grid"),k=y("vxe-form"),g=y("vxe-modal");return I(),B("div",$,[n(_,w({ref_key:"xGridDom",ref:l},c(h)),{"toolbar-btns":r(()=>[n(u,{status:"primary",icon:"vxe-icon-add",onClick:t[0]||(t[0]=a=>c(o).onShowModal())},{default:r(()=>t[1]||(t[1]=[d(" 新增用户 ")])),_:1,__:[1]}),n(u,{status:"danger",icon:"vxe-icon-delete"},{default:r(()=>t[2]||(t[2]=[d(" 批量删除 ")])),_:1,__:[2]})]),"role-column":r(({row:a,column:s})=>[n(m,{type:a[s.field]==="admin"?"primary":"warning",effect:"plain"},{default:r(()=>[d(T(a[s.field]),1)]),_:2},1032,["type"])]),"status-column":r(({row:a,column:s})=>[n(m,{type:a[s.field]?"success":"danger",effect:"plain"},{default:r(()=>[d(T(a[s.field]?"启用":"禁用"),1)]),_:2},1032,["type"])]),"row-operate":r(({row:a})=>[n(f,{link:"",type:"primary",onClick:s=>c(o).onShowModal(a)},{default:r(()=>t[3]||(t[3]=[d(" 修改 ")])),_:2,__:[3]},1032,["onClick"]),n(f,{link:"",type:"danger",onClick:s=>c(o).onDelete(a)},{default:r(()=>t[4]||(t[4]=[d(" 删除 ")])),_:2,__:[4]},1032,["onClick"])]),_:1},16),n(g,w({ref_key:"xModalDom",ref:x},c(b)),{default:r(()=>[n(k,w({ref_key:"xFormDom",ref:p},c(i)),null,16)]),_:1},16)])}}}),W=V(O,[["__scopeId","data-v-e06e6620"]]);export{W as default};
